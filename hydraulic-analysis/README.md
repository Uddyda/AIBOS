# 実行手順   

# ____________ EPANETのビルド_______________
~COF/EPANETに移動する。   
README.mdに書いている通りに、EPANETをビルドする。 

# ____________ 使用データの取得_______________
国土交通省のサイトから


# ///////////////////////////////////////////////////
# ____________ COFの実行手順_______________
# //////////////////////////////////////////////////
~/COF/hydraulic-analysisのディレクトリへ移動
以下の手順を順番に実行します。
または、exe_COF.pyを実行すると以下の手順をすべて自動でやってくれます。
こちらの方が処理が速かったりします


# 1.overlay.pyを実行
-京都府道路データと京都市領域の図が重なる部分から、京都市道路データをとる。
 <出力ファイル> 
  京都市道路データ：./tmp/Kyoto-shi_road.geojson

# 2.create_network.pyを実行
-ノードデータとエッジデータのgeojsonファイルを作成。また路線を定義する。路線は複数のエッジの集まり。
 <出力ファイル> 
  ノードデータ：./tmp/nodes.geojson　
  エッジデータ：./tmp/edges.json　
  路線グループ：./tmp/rosen.jsonが作成される。

# 3.elevation_input.pyを実行
-ノードデータ（./tmp/nodes.geojson）に京都市の標高の値を追加する。


# 4.matching_route_and_edges.pyを実行
-エッジに番号を付けて路線（./tmp/rosen.json）とエッジの番号を結び付ける。edges.geojsonに路線番号(route_key)を追加
　<出力ファイル>
  各路線に含まれるエッジキー:./tmp/matching_route_and_edges
  路線番号が追加されたエッジデータ:./tmp/nodes.geojson
# 5.redefine_edges.pyを実行
-管路データ（./tmp/edges.json）に必要なデータを入れる。

# 6.create_epanet_input.pyを実行
-EPANET用のインプットファイルを生成する。
COFのために特定の路線に水が流れないように設定。路線を変える度にインプットファイルが作成される。　
※時間かかるので注意、適宜break使ってください
 <出力ファイル>
  インプットファイル:./tmp/input_files/input(n).inp 
 ※(n)には消した路線番号が当てはまる　
 ※input0.inpは破損管路なしの以前と同じ解析
 ※実行前に同じ名前のディレクトリに入っていたものは削除されます

# 7.test_epanet.pyを実行
-水理解析の結果をjsonファイルで出力する 
※pytestコマンドで実行
  <出力ファイル>
  水理解析結果:./tmp/results/results_input(n).json　
  ※input(n)は使用したインプットファイル名
  ※実行前に同じ名前のディレクトリに入っていたものは削除されます

# 8.COF.pyを実行
-COFを行う。更新優先度がカラープロットで分かるようになっている。
  <出力ファイル>
  COFのイメージ画像:./tmp/COF_results.png



////9~10は実行しなくてもCOFは行えるが、考察などに役立つもの////

# 9.node_elevation.py
-ノードの標高をカラープロット
  <出力ファイル>
  ノードの標高イメージ:./tmp/ノード標高.png

# 10.visualize_results.py
-水理解析結果の視覚イメージを作成 　
※時間かかるので注意、適宜break使ってください
  <出力ファイル>
  水理解析結果イメージ:./tmp/image_results/results_input(n).png ※input(n)は使用したインプットファイル名
  ※実行前に同じ名前のディレクトリに入っていたものは削除されます


## ////////////////////////////////////////////////(end)
